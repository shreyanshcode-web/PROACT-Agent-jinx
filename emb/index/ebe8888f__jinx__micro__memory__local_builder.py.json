{"file_rel": "jinx\\micro\\memory\\local_builder.py", "file_sha256": "8ccd2d187cc20d4c7365964e015daf9335adf5400ea006cbbd3a0a78d549fe66", "updated_ts": 1760763312.5459297, "total_chunks": 12, "chunks": [{"sha": "3eb844e20de4b237f8e69415196700db946173ace5177b977cbf5db09400b527", "index": 0, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\3eb844e20de4b237f8e69415196700db946173ace5177b977cbf5db09400b527.json", "terms": ["import", "from", "jinx", "micro", "memory", "join", "_tag_alt", "path", "root", "sub", "_memory_dir", "all_tags", "project_root", "embeddings", "__future__", "_extract_decision_frags", "_extract_pref_frags", "_facts_load", "_facts_save", "_is_code_like_line", "_load_pins", "_mem_dir", "_tool_block_re", "ensure_nl", "extract_decision_fragments"], "text_preview": "from __future__ import annotations\n\nimport os\nimport re\nimport json\nimport time\nfrom typing import Dict, List, Tuple, Any\n\nfrom jinx.config import ALL_TAGS\nfrom jinx.micro.embeddings.project_identifiers import extract_identifiers\nfrom jinx.micro.memory.sto", "line_start": 1, "line_end": 39}, {"sha": "55c6f19a1d425f7f874e56a16746f48c7ff6221feb26fc1a8cd333551ad45c93", "index": 1, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\55c6f19a1d425f7f874e56a16746f48c7ff6221feb26fc1a8cd333551ad45c93.json", "terms": ["str", "lines", "list", "cleaned", "compile", "cur", "out", "rep", "return", "append", "blk", "blocks", "def", "text", "_collect", "len", "strip", "sub", "while", "_dedupe_consecutive", "_email_re", "_path_re", "_set_re", "_strip_tool_blocks", "_token_re"], "text_preview": "_PATH_RE = re.compile(r\"(?:[A-Za-z]:\\\\[^\\r\\n]+|(?:\\.|\\.{1,2})?/(?:[^\\s/]+/)*[^\\s/]+\\.[A-Za-z0-9]{1,6})\")\n \n_SET_RE = re.compile(r\"\\b([A-Z_]{2,})\\s*=\\s*([^\\s,;]+)\")\n\n# PII redactors\n_EMAIL_RE = re.compile(r\"\\b[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9.-]+\\b", "line_start": 40, "line_end": 84}, {"sha": "0b31c00adada4b7917e9f8aa33c01bf2fc6206665eac3cc8060f16c2e6079a3d", "index": 2, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\0b31c00adada4b7917e9f8aa33c01bf2fc6206665eac3cc8060f16c2e6079a3d.json", "terms": ["text", "str", "buf", "cur_role", "not", "return", "none", "jinx", "lim", "strip", "user", "the", "def", "except", "exception", "int", "labels", "lines", "list", "out", "raw", "sub", "transcript", "try", "_build_compact"], "text_preview": "def _build_compact(transcript: str, max_lines: int) -> str:\n    tx = (transcript or \"\").strip()\n    if not tx:\n        return \"\"\n    raw = [ln.rstrip() for ln in tx.splitlines() if ln.strip()]\n    if not raw:\n        return \"\"\n    # Build turn-based compac", "line_start": 85, "line_end": 119}, {"sha": "d4abccf73e63bf9739490356362f61012ec4bc1403374af3cefa25e5010673ac", "index": 3, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\d4abccf73e63bf9739490356362f61012ec4bc1403374af3cefa25e5010673ac.json", "terms": ["user", "else", "cur_role", "val", "buf", "label", "jinx", "_flush", "title", "append", "note", "continue", "group", "out", "strip", "_is_code_like_line", "agent", "allowed", "and", "capitalize", "code", "content", "continuation", "error", "fallback"], "text_preview": "# Fallback: treat as note\n            out.append(f\"Note: {text}\")\n        buf = []\n\n    for ln in raw:\n        # Robust label parse (leading spaces allowed)\n        m = re.match(r\"^\\s*(User|Jinx|Error|State|Note):\\s*(.*)$\", ln, re.IGNORECASE)\n        if m:", "line_start": 120, "line_end": 151}, {"sha": "deedaa69127f9e50bdcc1471322172f81954dbfb6e117f9d9940d9a8fcb7fc8e", "index": 4, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\deedaa69127f9e50bdcc1471322172f81954dbfb6e117f9d9940d9a8fcb7fc8e.json", "terms": ["str", "out", "return", "def", "list", "max_lines", "items", "append", "text", "_redact_text", "counter", "except", "exception", "float", "for", "group", "strip", "sub", "try", "_dedupe_consecutive", "_email_re", "_extract_settings", "_flush", "_is_code_like_line", "_redact_line"], "text_preview": "# Unknown provenance â€” classify by heuristics\n            if _is_code_like_line(ln):\n                out.append(f\"Jinx: {ln[:320]}\")\n            else:\n                out.append(f\"Note: {ln[:320]}\")\n    _flush()\n\n    # Keep only the most recent max_lines, ", "line_start": 152, "line_end": 198}, {"sha": "a286a64335762ad08229f3a8af729cf9483214ab7d70f186ba00a45ae84124e9", "index": 5, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\a286a64335762ad08229f3a8af729cf9483214ab7d70f186ba00a45ae84124e9.json", "terms": ["int", "half_days", "str", "facts", "last_ts", "decay", "float", "for", "evergreen_prev", "now_ms", "prev_lines", "stale_drop", "strip", "time", "bucket", "dict", "except", "exception", "get", "getenv", "key", "out", "splitlines", "text", "transcript"], "text_preview": "for ln in (text or \"\").splitlines():\n        out.append(_redact_line(ln))\n    return \"\\n\".join(out)\n\n\ndef _build_evergreen(transcript: str, evergreen_prev: str, facts_cap: int, top_paths: int, top_symbols: int, top_prefs: int, top_decs: int) -> str:\n    te", "line_start": 199, "line_end": 229}, {"sha": "447144729da4386ec5db30f8ef49850357d03e5013494f247010dd222db85168", "index": 6, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\447144729da4386ec5db30f8ef49850357d03e5013494f247010dd222db85168.json", "terms": ["dict", "float", "paths", "symbols", "facts", "get", "prefs", "for", "str", "frag", "text", "new_bucket", "decisions", "except", "exception", "strip", "tok", "try", "_extract_pref_frags", "_path_re", "extract_identifiers", "max_items", "stale_drop", "bucket", "decay"], "text_preview": "for k, v in bucket.items():\n                    try:\n                        nv = float(v) * float(decay)\n                    except Exception:\n                        nv = 0.0\n                    if nv >= stale_drop:\n                        new_bucket[k] ", "line_start": 230, "line_end": 265}, {"sha": "f61e0de151a39a0f6f50222205d430c19d49b88d246d7e78c3d408f80cf0b3b6", "index": 7, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\f61e0de151a39a0f6f50222205d430c19d49b88d246d7e78c3d408f80cf0b3b6.json", "terms": ["facts", "_cap", "get", "for", "_pins", "decisions", "decs", "float", "frag", "str", "lines", "facts_cap", "pin_lines", "dict", "paths", "prefs", "symbols", "keep", "low", "pinned", "return", "_extract_decision_frags", "_facts_save", "_load_pins", "_redact_line"], "text_preview": "for frag in _extract_decision_frags(text):\n        decs[frag] = float(decs.get(frag, 0.0)) + 1.0\n    facts[\"decisions\"] = decs\n\n    # Apply cap\n    def _cap(d: Dict[str, float]) -> Dict[str, float]:\n        if len(d) <= facts_cap:\n            return d\n    ", "line_start": 266, "line_end": 299}, {"sha": "80567b89a0f4e94430070c0b17f8fa1a70c74e76d414cb418f24f5b229f86e0d", "index": 8, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\80567b89a0f4e94430070c0b17f8fa1a70c74e76d414cb418f24f5b229f86e0d.json", "terms": ["facts", "get", "lines", "_topn", "append", "float", "for", "setdefault", "decisions", "paths", "prefs", "symbols", "elif", "low", "startswith", "strip", "dec", "decision", "pref", "symbol", "pin_lines", "top_decs", "top_paths", "top_prefs", "top_symbols"], "text_preview": "facts.setdefault(\"paths\", {})[k] = float(facts.get(\"paths\", {}).get(k, 0.0)) + 2.0\n        elif low.startswith(\"symbol: \"):\n            k = pl[8:].strip()\n            if k:\n                facts.setdefault(\"symbols\", {})[k] = float(facts.get(\"symbols\", {})", "line_start": 300, "line_end": 324}, {"sha": "733de0097e916fe4d75982385112f376b4cc744035a25685ab52c104f5219aa7", "index": 9, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\733de0097e916fe4d75982385112f376b4cc744035a25685ab52c104f5219aa7.json", "terms": ["lines", "none", "max_lines", "str", "for", "int", "strip", "cur_settings", "evergreen_prev", "prev_settings", "evergreen", "append", "getenv", "max", "memory", "transcript", "try", "_blocks", "_extract_settings", "_redact_text", "_strip_tool_blocks", "build_local_memory", "compact_lines", "jinx_mem_compact_max_lines", "jinx_mem_evergreen_max_lines"], "text_preview": "cur_settings = _extract_settings(text)\n    for st in cur_settings:\n        lines.append(st)\n\n    # Carry previous explicit settings if absent this round\n    prev_settings = [ln for ln in prev_lines if ln.lower().startswith(\"setting: \")]\n    for st in prev_", "line_start": 325, "line_end": 358}, {"sha": "b4c76bc5937c698ad5cd77d0dd698854cb8ef860706ed610f7e92c59875ebac8", "index": 10, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\b4c76bc5937c698ad5cd77d0dd698854cb8ef860706ed610f7e92c59875ebac8.json", "terms": ["except", "exception", "getenv", "int", "try", "max", "dyn_on", "facts_cap", "token_hint", "top_decs", "top_paths", "top_prefs", "top_symbols", "tgt", "compact_lines", "jinx_mem_dynamic_budget", "jinx_mem_dynamic_target", "jinx_mem_facts_cap", "jinx_mem_top_decs", "jinx_mem_top_paths", "jinx_mem_top_prefs", "jinx_mem_top_symbols", "and", "based", "budgets"], "text_preview": "except Exception:\n        compact_lines = 200\n    try:\n        facts_cap = max(50, int(os.getenv(\"JINX_MEM_FACTS_CAP\", \"800\")))\n    except Exception:\n        facts_cap = 800\n    try:\n        top_paths = max(8, int(os.getenv(\"JINX_MEM_TOP_PATHS\", \"60\")))\n  ", "line_start": 359, "line_end": 392}, {"sha": "d90ea79055187220610896a621d62a9d3a34509f06e30df20e97f3cd4cb0997b", "index": 11, "path": "ebe8888f__jinx__micro__memory__local_builder.py\\d90ea79055187220610896a621d62a9d3a34509f06e30df20e97f3cd4cb0997b.json", "terms": ["scale", "max", "int", "compact_lines", "facts_cap", "top_decs", "top_paths", "top_prefs", "top_symbols", "evergreen", "compact", "ensure_nl", "t_clean", "rstrip", "tgt", "when", "math", "ratio", "_build_compact", "_build_evergreen", "max_lines", "and", "apply", "but", "caps"], "text_preview": "# Scale in [0.6, 1.2], shrink when tokens>>target, expand when small\n        import math\n        ratio = (th - tgt) / max(1000.0, float(tgt))\n        scale = 1.0 - 0.4 * math.tanh(ratio)  # ~0.6..1.4 but clamp to 1.2\n        if scale > 1.2:\n            sca", "line_start": 393, "line_end": 413}], "file_terms": ["str", "facts", "get", "int", "text", "lines", "float", "for", "out", "strip", "except", "exception", "return", "try", "append", "jinx", "max", "dict", "paths", "list", "import", "symbols", "def", "getenv", "prefs"]}