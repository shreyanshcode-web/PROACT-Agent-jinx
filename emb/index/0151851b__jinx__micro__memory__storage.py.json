{"file_rel": "jinx\\micro\\memory\\storage.py", "file_sha256": "9dee35c26fcd1a594a0b9af02290bf6d09d5af0af32b1cfd5aa19d9df2d745b2", "updated_ts": 1760763312.6403062, "total_chunks": 9, "chunks": [{"sha": "261ce2e8634293b0481b45cd2ace3a01a61abb759a6f8924af920fdb68053e56", "index": 0, "path": "0151851b__jinx__micro__memory__storage.py\\261ce2e8634293b0481b45cd2ace3a01a61abb759a6f8924af920fdb68053e56.json", "terms": ["_mem_dir", "join", "path", "import", "jinx", "memory", "from", "root", "sub", "_memory_dir", "jinx_memory_dir", "project_root", "paths", "__future__", "_ch_decs", "_ch_paths", "_ch_prefs", "_ch_symbols", "_compact_path", "_evergreen_path", "_hist_dir", "_token_hint", "_topics_dir", "async_utils", "evergreen_memory"], "text_preview": "from __future__ import annotations\n\nimport os\nimport time\n\nfrom jinx.async_utils.fs import read_text_raw, write_text\nfrom jinx.state import shard_lock\nfrom jinx.log_paths import INK_SMEARED_DIARY, EVERGREEN_MEMORY\nfrom jinx.micro.embeddings.project_config ", "line_start": 1, "line_end": 33}, {"sha": "48ffd3c1ffdb385719ce80ecd0056de043a5b08017a2ea8f29053ab92c64e256", "index": 1, "path": "0151851b__jinx__micro__memory__storage.py\\48ffd3c1ffdb385719ce80ecd0056de043a5b08017a2ea8f29053ab92c64e256.json", "terms": ["text", "name", "obj", "except", "exception", "try", "exist_ok", "buffer", "get", "buffers", "lines", "makedirs", "path", "true", "_ensure_dirs", "_hist_keep", "_json", "_mem_dir", "_open_buffers", "open_buffers", "async", "continue", "def", "join", "jsonl"], "text_preview": "_OPEN_BUFFERS = os.path.join(_MEM_DIR, \"open_buffers.jsonl\")\ntry:\n    _HIST_KEEP = max(0, int(os.getenv(\"JINX_MEM_HISTORY_KEEP\", \"50\")))\nexcept Exception:\n    _HIST_KEEP = 50\n\n\ndef _ensure_dirs() -> None:\n    try:\n        os.makedirs(_MEM_DIR, exist_ok=Tru", "line_start": 34, "line_end": 74}, {"sha": "2e39d147782778998978b3097de761a41b8a789bff17f689eb13d86400b1e37e", "index": 2, "path": "0151851b__jinx__micro__memory__storage.py\\2e39d147782778998978b3097de761a41b8a789bff17f689eb13d86400b1e37e.json", "terms": ["return", "async", "memory", "def", "int", "path", "str", "txt", "_token_hint", "shard_lock", "await", "try", "with", "_evergreen_path", "read_text_raw", "evergreen", "absolute", "estimate", "except", "exception", "exists", "jinx", "last", "prompt", "read"], "text_preview": "def open_buffers_path() -> str:\n    \"\"\"Return absolute path to the open buffers snapshot file.\"\"\"\n    return _OPEN_BUFFERS\n\n\nasync def write_token_hint(tokens: int) -> None:\n    \"\"\"Write last prompt token estimate to memory dir.\"\"\"\n    async with shard_loc", "line_start": 75, "line_end": 112}, {"sha": "61621ddb11c70cb33f86fb84b199566be0a40ea3dd044cc1d8c6138c21fd4938", "index": 3, "path": "0151851b__jinx__micro__memory__storage.py\\61621ddb11c70cb33f86fb84b199566be0a40ea3dd044cc1d8c6138c21fd4938.json", "terms": ["return", "txt", "_compact_path", "int", "except", "exception", "read_text_raw", "await", "exists", "path", "try", "_evergreen_path", "ink_smeared_diary", "st_mtime", "compact", "memory", "async", "def", "diary", "else", "evergreen", "pass", "stat", "compact_mtime_ms", "evergreen_memory"], "text_preview": "if txt != \"\":\n                    return txt\n        except Exception:\n            pass\n        evergreen = await read_text_raw(EVERGREEN_MEMORY)\n    return evergreen or \"\"\n\n\ndef get_memory_mtimes() -> tuple[int, int]:\n    \"\"\"Return (compact_mtime_ms, ever", "line_start": 113, "line_end": 150}, {"sha": "1e3ced85f8e534a563bef9e507a2708d5cf75badf8388d5566a60dd9c5ad8ae6", "index": 4, "path": "0151851b__jinx__micro__memory__storage.py\\1e3ced85f8e534a563bef9e507a2708d5cf75badf8388d5566a60dd9c5ad8ae6.json", "terms": ["str", "line", "path", "buckets", "low", "append", "decisions", "paths", "prefs", "startswith", "symbols", "elif", "durable_text", "async", "def", "dict", "kind", "list", "lower", "not", "raw", "return", "strip", "_ch_decs", "_ch_paths"], "text_preview": "def _parse_channels(durable_text: str) -> dict[str, list[str]]:\n    buckets: dict[str, list[str]] = {\n        \"paths\": [],\n        \"symbols\": [],\n        \"prefs\": [],\n        \"decisions\": [],\n    }\n    for raw in (durable_text or \"\").splitlines():\n        ", "line_start": 151, "line_end": 189}, {"sha": "acfe54834a120682ddf6110614fce5ce60a4681c89262cb90d4071bfb2d24cd6", "index": 5, "path": "0151851b__jinx__micro__memory__storage.py\\acfe54834a120682ddf6110614fce5ce60a4681c89262cb90d4071bfb2d24cd6.json", "terms": ["return", "str", "path", "memory", "and", "txt", "compact", "topic", "async", "def", "jinx", "legacy", "name", "ensure_nl", "evergreen", "none", "durable", "except", "exception", "not", "writes", "_ensure_dirs", "_topics_dir", "compact_out", "evergreen_memory"], "text_preview": "if txt != \"\":\n                    return txt\n        except Exception:\n            return \"\"\n    return \"\"\n\n\nasync def read_topic(name: str) -> str:\n    \"\"\"Read a topic file from .jinx/memory/topics/<name>.md if present.\"\"\"\n    topic = (name or \"\").strip()", "line_start": 190, "line_end": 226}, {"sha": "b5f42f617daf02585ae1d07d47c7a1bac4d670639e0edd39eb56d29c013343e8", "index": 6, "path": "0151851b__jinx__micro__memory__storage.py\\b5f42f617daf02585ae1d07d47c7a1bac4d670639e0edd39eb56d29c013343e8.json", "terms": ["buckets", "get", "write_text", "await", "none", "not", "ensure_nl", "join", "durable_out", "durable", "try", "hist_name", "time", "except", "exception", "pass", "paths", "prefs", "symbols", "_ch_paths", "_ch_prefs", "_ch_symbols", "_compact_path", "_evergreen_path", "_hist_dir"], "text_preview": "ts = int(time.time() * 1000)\n    hist_name = f\"{ts}_state.md\"\n    hist_path = os.path.join(_HIST_DIR, hist_name)\n\n    async with shard_lock:\n        # Canonical store\n        try:\n            await write_text(_COMPACT_PATH, compact_out)\n        except Exce", "line_start": 227, "line_end": 252}, {"sha": "d1cfb0f4900703f0532b81b9b15a29a3e2be0f5c5d5c698133ef5fac66ca1ba2", "index": 7, "path": "0151851b__jinx__micro__memory__storage.py\\d1cfb0f4900703f0532b81b9b15a29a3e2be0f5c5d5c698133ef5fac66ca1ba2.json", "terms": ["write_text", "await", "except", "exception", "files", "pass", "try", "_hist_dir", "ensure_nl", "durable", "join", "_hist_keep", "compact_out", "durable_out", "snap_lines", "and", "for", "history", "path", "_ch_decs", "_state", "evergreen_memory", "hist_path", "ink_smeared_diary", "ts_ms"], "text_preview": "await write_text(_CH_DECS, ensure_nl(\"\\n\".join(buckets.get(\"decisions\") or [])))\n            except Exception:\n                pass\n        # Legacy files for backward compatibility with existing readers\n        try:\n            await write_text(INK_SMEARE", "line_start": 253, "line_end": 279}, {"sha": "222401dfe786e552153f860be85a074b45b4233b89de25c7cd2eeb8ef4b498ec", "index": 8, "path": "0151851b__jinx__micro__memory__storage.py\\222401dfe786e552153f860be85a074b45b4233b89de25c7cd2eeb8ef4b498ec.json", "terms": ["files", "except", "exception", "pass", "_hist_keep", "for", "len", "max", "remove", "sorted", "try"], "text_preview": "for p in sorted(files)[: max(0, len(files) - _HIST_KEEP)]:\n                    try:\n                        os.remove(p)\n                    except Exception:\n                        pass\n    except Exception:\n        pass", "line_start": 280, "line_end": 286}], "file_terms": ["path", "return", "join", "except", "exception", "try", "str", "memory", "await", "async", "txt", "buckets", "def", "_mem_dir", "jinx", "write_text", "pass", "get", "ensure_nl", "none", "not", "int", "shard_lock", "files", "with"]}