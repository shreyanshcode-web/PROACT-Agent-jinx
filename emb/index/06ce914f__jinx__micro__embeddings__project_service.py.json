{"file_rel": "jinx\\micro\\embeddings\\project_service.py", "file_sha256": "82a35afd036cb37c91061fd5f0e2a57e580314bb3032d8b25579c5f145276c2d", "updated_ts": 1760763311.322075, "total_chunks": 11, "chunks": [{"sha": "eb363caa9ea35434f735c6f031e898dc160122c26e8250c9991a6eeddb2bd7c4", "index": 0, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\eb363caa9ea35434f735c6f031e898dc160122c26e8250c9991a6eeddb2bd7c4.json", "terms": ["import", "from", "none", "self", "root", "ensure_project_dirs", "load_hash_db", "use_watchdog", "asyncio", "def", "enable", "watchhandle", "__future__", "__init__", "_task", "_use_watchdog", "_watch", "drain_queue", "embed_if_changed", "exclude_dirs", "file_should_include", "get_record", "include_exts", "invalidate_file", "iter_candidate_files"], "text_preview": "from __future__ import annotations\n\nimport asyncio\nimport os\nimport time\nfrom typing import Dict, List, Tuple\nimport jinx.state as jx_state\n\nfrom .project_paths import ensure_project_dirs, PROJECT_INDEX_DIR, safe_rel_path\nfrom .project_hashdb import load_h", "line_start": 1, "line_end": 43}, {"sha": "695e3493ab4d87b7d9490b4b31db6e394e6885d3893d4d5687d716d6f5307d66", "index": 1, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\695e3493ab4d87b7d9490b4b31db6e394e6885d3893d4d5687d716d6f5307d66.json", "terms": ["exclude_dirs", "include_exts", "max_file_bytes", "asyncio", "def", "nmax", "out", "root", "iter_candidate_files", "n_local", "set", "for", "initial", "int", "range", "try", "_get_batch", "_next_batch", "_pull", "gen_local", "max_concurrency", "out_local", "allow", "app", "append"], "text_preview": "sem = asyncio.Semaphore(MAX_CONCURRENCY)\n        # Initial delay to let app start\n        await asyncio.sleep(0.2)\n\n        # One initial full scan to build baseline (cooperative batching)\n        mutated = False\n        pending: set[asyncio.Task] = set()\n", "line_start": 44, "line_end": 76}, {"sha": "9fe8f9506ce0c944586f0ea31bc0f705ed9a9b81bb9bc94eee41f31243173477", "index": 2, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\9fe8f9506ce0c944586f0ea31bc0f705ed9a9b81bb9bc94eee41f31243173477.json", "terms": ["asyncio", "await", "pending", "batch", "for", "true", "abs_p", "out_local", "rel_p", "sem", "break", "done", "drain", "except", "mutated", "return", "sleep", "try", "while", "_get_batch", "_pull", "as_completed", "create_task", "embed_if_changed", "first_completed"], "text_preview": "out_local.append(next(gen_local))\n                    except StopIteration:\n                        break\n                return out_local\n            return await asyncio.to_thread(_pull, gen, 256)\n        while True:\n            batch = await _get_batch(", "line_start": 77, "line_end": 105}, {"sha": "c43db21ca2380db624d4f91edea90c58bcc06ad1c2ab467fcc751057a8a2c5f5", "index": 3, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\c43db21ca2380db624d4f91edea90c58bcc06ad1c2ab467fcc751057a8a2c5f5.json", "terms": ["asyncio", "watcher_ok", "self", "changes_q", "false", "handle", "loop", "mutated", "true", "try", "queue", "str", "time", "await", "event", "except", "exception", "root", "sleep", "_use_watchdog", "_watch", "abs_path", "drain_queue", "get_running_loop", "is_set"], "text_preview": "except Exception:\n                    pass\n        if prune_deleted(self.root, db):\n            mutated = True\n        if mutated:\n            save_hash_db(db)\n\n        # Try to start watchdog-based watcher\n        watcher_ok = False\n        changes_q: asy", "line_start": 106, "line_end": 136}, {"sha": "2e6f81344bb469c87aa6ab3b69c350aeeb9516e1e152037b968194a58a2aa95a", "index": 4, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\2e6f81344bb469c87aa6ab3b69c350aeeb9516e1e152037b968194a58a2aa95a.json", "terms": ["rel_p", "continue", "abs_path", "seen_paths", "not", "and", "reconcile_sec", "abs_p", "need_reconcile", "set", "time", "drained", "except", "exception", "for", "now", "path", "try", "invalidate_file", "last_reconcile", "abspath", "add", "cache", "empty", "even"], "text_preview": "# Periodic reconcile even if queue is empty\n                    now = time.time()\n                    need_reconcile = RECONCILE_SEC > 0 and (now - last_reconcile) >= RECONCILE_SEC\n                    if not drained and not need_reconcile:\n                ", "line_start": 137, "line_end": 160}, {"sha": "5f01e449c65e7cf470a5a67901f9f0730fbf5eac3496527af1ea91d8bd4e4725", "index": 5, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\5f01e449c65e7cf470a5a67901f9f0730fbf5eac3496527af1ea91d8bd4e4725.json", "terms": ["continue", "abs_p", "mutated", "exclude_dirs", "include_exts", "rel_p", "sem", "time", "except", "exception", "true", "try", "embed_if_changed", "file_should_include", "last_reconcile", "max_file_bytes", "prune_single", "save_hash_db", "and", "apply", "await", "check", "deleted", "dirs", "events"], "text_preview": "if ev == \"deleted\":\n                            if prune_single(self.root, db, rel_p):\n                                mutated = True\n                            continue\n                        # Re-apply filters for events (extension and exclude dirs), t", "line_start": 161, "line_end": 185}, {"sha": "aec3a2ea2b3ea63649dfc334947649aa0cc1db41b5c38830d2d61ee7298b4186", "index": 6, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\aec3a2ea2b3ea63649dfc334947649aa0cc1db41b5c38830d2d61ee7298b4186.json", "terms": ["batch2", "recon_pending", "rel_p", "asyncio", "exclude_dirs", "include_exts", "max_file_bytes", "abs_p", "it2", "sem", "set", "for", "not", "pass", "while", "__exhausted__", "create_task", "embed_if_changed", "invalidate_file", "iter_candidate_files", "need_reconcile", "to_thread", "add", "artifacts", "await"], "text_preview": "# Reconcile pass (scan mtime & missing artifacts) on schedule\n                    if need_reconcile:\n                        recon_pending: set[asyncio.Task] = set()\n                        it2 = iter_candidate_files(\n                            self.root,", "line_start": 186, "line_end": 205}, {"sha": "18b80a32f121532c042dc2859ac64d38c4baef6909c9f14ff5d3ec584537149c", "index": 7, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\18b80a32f121532c042dc2859ac64d38c4baef6909c9f14ff5d3ec584537149c.json", "terms": ["recon_pending", "asyncio", "await", "mutated", "true", "time", "done", "except", "exception", "for", "pass", "self", "try", "_watch", "as_completed", "first_completed", "last_reconcile", "prune_deleted", "return_when", "save_hash_db", "exit", "finally", "none", "not", "observer"], "text_preview": "done, recon_pending = await asyncio.wait(recon_pending, return_when=asyncio.FIRST_COMPLETED)\n                                for t in done:\n                                    try:\n                                        if await t:\n                       ", "line_start": 206, "line_end": 228}, {"sha": "0e0e24adf473f70b7a138069ea99f3b9710c93dfe7ecc3b55cd93631e48b7fb6", "index": 8, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\0e0e24adf473f70b7a138069ea99f3b9710c93dfe7ecc3b55cd93631e48b7fb6.json", "terms": ["batch3", "out", "exclude_dirs", "include_exts", "max_file_bytes", "_pull_batch", "_pull_local", "it3", "set", "asyncio", "await", "break", "def", "for", "gen", "return", "self", "true", "try", "while", "_watch", "abs_p", "iter_candidate_files", "perf_counter", "rel_p"], "text_preview": "self._watch.stop()\n        else:\n            # Fallback to periodic scanning loop\n            while True:\n                t0 = time.perf_counter()\n                mutated = False\n                scan_pending: set[asyncio.Task] = set()\n                it3 =", "line_start": 229, "line_end": 257}, {"sha": "cc90096f29e000b784cccb2c0e5ec9c896a7bbeb5bc33cb1eb9d0ac13bc12536", "index": 9, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\cc90096f29e000b784cccb2c0e5ec9c896a7bbeb5bc33cb1eb9d0ac13bc12536.json", "terms": ["scan_pending", "asyncio", "await", "except", "exception", "pass", "rel_p", "sem", "done", "for", "mutated", "sleep", "true", "try", "abs_p", "as_completed", "create_task", "embed_if_changed", "first_completed", "invalidate_file", "is_set", "jx_state", "prune_deleted", "return_when", "throttle_event"], "text_preview": "invalidate_file(rel_p)\n                        except Exception:\n                            pass\n                        scan_pending.add(asyncio.create_task(embed_if_changed(db, abs_p, rel_p, sem=sem)))\n                    while len(scan_pending) > 64:\n ", "line_start": 258, "line_end": 281}, {"sha": "0638a61bd47d045751d45441b2a9c0b0ff160ae9ac0a200f3b4e4c02d1957d75", "index": 10, "path": "06ce914f__jinx__micro__embeddings__project_service.py\\0638a61bd47d045751d45441b2a9c0b0ff160ae9ac0a200f3b4e4c02d1957d75.json", "terms": ["none", "asyncio", "root", "elapsed_ms", "wait_ms", "await", "mutated", "sleep", "svc", "create_task", "is_set", "jx_state", "perf_counter", "save_hash_db", "scan_interval_ms", "start_project_embeddings_task", "throttle_event", "def", "embeddings", "max", "name", "project", "projectembeddingsservice", "return", "run"], "text_preview": "mutated = True\n                if mutated:\n                    save_hash_db(db)\n                elapsed_ms = (time.perf_counter() - t0) * 1000.0\n                wait_ms = max(50.0, SCAN_INTERVAL_MS - elapsed_ms)\n                await asyncio.sleep(wait_ms ", "line_start": 282, "line_end": 294}], "file_terms": ["asyncio", "await", "root", "mutated", "self", "try", "for", "true", "except", "rel_p", "import", "none", "exception", "exclude_dirs", "include_exts", "abs_p", "max_file_bytes", "time", "not", "from", "pass", "sleep", "sem", "set", "continue"]}