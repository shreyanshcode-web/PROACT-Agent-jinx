{"file_rel": "jinx\\micro\\llm\\chains.py", "file_sha256": "43745c63a9ed5df6a04243811f68cfc3d5d2b423d10a581483dc26b118eb1b15", "updated_ts": 1760763311.9803672, "total_chunks": 8, "chunks": [{"sha": "c1b95012a655d8611b897f65c33e30320d2923c0d2753ae3c82ce8a98d161a13", "index": 0, "path": "49599ce2__jinx__micro__llm__chains.py\\c1b95012a655d8611b897f65c33e30320d2923c0d2753ae3c82ce8a98d161a13.json", "terms": ["jinx", "llm", "micro", "from", "import", "__future__", "_run_planner", "allow_execution", "build_citation_block", "build_metrics_block", "chain_citations", "chain_context", "chain_evidence", "chain_finalize", "chain_gate", "chain_metrics", "chain_plan", "chain_quality", "chain_reflect", "chain_render", "chain_resilience", "chain_trace", "chain_utils", "finalize_context", "gather_context_for_subs"], "text_preview": "from __future__ import annotations\nimport os\nfrom typing import Any, Dict, List\n\nfrom jinx.micro.llm.chain_utils import truthy_env\nfrom jinx.micro.llm.chain_evidence import gather_planner_evidence\nfrom jinx.micro.llm.chain_reflect import run_reflector\nfrom", "line_start": 1, "line_end": 30}, {"sha": "d0544c6a251628b39abb5558a8fd32f97a1ea71d735e537801fceaabc3085e32", "index": 1, "path": "49599ce2__jinx__micro__llm__chains.py\\d0544c6a251628b39abb5558a8fd32f97a1ea71d735e537801fceaabc3085e32.json", "terms": ["allowed", "str", "user_text", "await", "gate", "max_subqueries", "planner_ms", "none", "trace_plan", "int", "the", "and", "async", "budgets", "context", "def", "not", "phase", "planner", "return", "string", "true", "_run_planner", "allow_execution", "build_planner_context"], "text_preview": "async def run_planner(user_text: str, *, max_subqueries: int | None = None, planner_ms: int | None = 400) -> Dict[str, Any]:\n    \"\"\"Delegate to micro-module implementation for planner call.\"\"\"\n    return await _run_planner(user_text, max_subqueries=max_sub", "line_start": 31, "line_end": 54}, {"sha": "4251c9382a12bc4e99ed84443ebde77fb61219e0fbb1f4e6d977846b7efe00fa", "index": 2, "path": "49599ce2__jinx__micro__llm__chains.py\\4251c9382a12bc4e99ed84443ebde77fb61219e0fbb1f4e6d977846b7efe00fa.json", "terms": ["last", "try", "brain", "except", "exception", "warns", "parts", "cortex_block", "advisory", "append", "not", "truthy_env", "and", "await", "list", "pass", "plan", "str", "jinx_chained_include_cortex", "jinx_chained_include_warnings", "load_last_plan", "render_plan_brain", "render_plan_cortex", "render_plan_guidance", "render_plan_warnings"], "text_preview": "await trace_plan({\"phase\": \"resilience_block\", \"allowed\": False})\n        # Try last known good plan as a fallback brain\n        try:\n            last = await load_last_plan()\n        except Exception:\n            last = None\n        if not last:\n         ", "line_start": 55, "line_end": 87}, {"sha": "02f7f06946083af0ae810653a94a34ffc237b59aa17ee64e4083298f70323a1a", "index": 3, "path": "49599ce2__jinx__micro__llm__chains.py\\02f7f06946083af0ae810653a94a34ffc237b59aa17ee64e4083298f70323a1a.json", "terms": ["plan", "get", "last", "warns", "await", "except", "exception", "try", "final_ctx", "is_empty", "str", "user_text", "validate_plan", "strip", "fallback", "lwarns", "not", "pass", "empty_plan", "finalize_context", "load_last_plan", "run_planner", "sub_queries", "trace_plan", "advisory"], "text_preview": "pass\n        final_ctx = \"\\n\".join([p for p in parts if p])\n        await finalize_context(user_text, last, final_ctx)\n        return final_ctx\n    plan = await run_planner(user_text)\n    # Validate structural quality and render optional warnings block\n   ", "line_start": 88, "line_end": 117}, {"sha": "74e8d547dba958c8b191442fe7fbe7d854263db1a1512b5dc742ec38558a5e90", "index": 4, "path": "49599ce2__jinx__micro__llm__chains.py\\74e8d547dba958c8b191442fe7fbe7d854263db1a1512b5dc742ec38558a5e90.json", "terms": ["plan", "subs", "parts", "str", "brain", "except", "exception", "pass", "try", "cortex_block", "truthy_env", "append", "strip", "advisory", "and", "for", "get", "list", "warns", "final_ctx", "jinx_chained_clarify_as_subs", "jinx_chained_include_cortex", "jinx_chained_include_warnings", "render_plan_brain", "render_plan_cortex"], "text_preview": "subs: List[str] = plan.get(\"sub_queries\") or []\n    if advisory and truthy_env(\"JINX_CHAINED_CLARIFY_AS_SUBS\", \"1\"):\n        try:\n            subs = subs + [str(x).strip() for x in (plan.get(\"clarifiers\") or []) if str(x).strip()]\n        except Exception:", "line_start": 118, "line_end": 146}, {"sha": "5037ef3f6bf91f9b98f4b8792537acbbb41bde06a3eef99f757c495c094bc374", "index": 5, "path": "49599ce2__jinx__micro__llm__chains.py\\5037ef3f6bf91f9b98f4b8792537acbbb41bde06a3eef99f757c495c094bc374.json", "terms": ["plan", "kernels_code", "brain", "try", "safe_k", "the", "except", "exception", "kblock", "parts", "dialog_ms", "final_ctx", "proj_ms", "append", "await", "block", "for", "getenv", "int", "kernels", "pass", "str", "finalize_context", "gather_context_for_subs", "jinx_chained_dialog_ctx_ms"], "text_preview": "await finalize_context(user_text, plan, final_ctx)\n        return final_ctx\n\n    # Tight budgets for extra retrieval\n    dialog_ms = int(os.getenv(\"JINX_CHAINED_DIALOG_CTX_MS\", \"140\"))\n    proj_ms = int(os.getenv(\"JINX_CHAINED_PROJECT_CTX_MS\", \"500\"))\n\n   ", "line_start": 147, "line_end": 179}, {"sha": "35dbed54a0e9943432247b3dada1d116b8d76581803becaa64e1cfd3e209fdbe", "index": 6, "path": "49599ce2__jinx__micro__llm__chains.py\\35dbed54a0e9943432247b3dada1d116b8d76581803becaa64e1cfd3e209fdbe.json", "terms": ["reflect", "evidence", "get", "except", "exception", "plan", "cortex_block", "append", "await", "len", "try", "and", "for", "not", "parts", "pass", "queries", "subs", "sum", "warns", "c_total", "d_total", "gather_planner_evidence", "jinx_chained_include_warnings", "q_count"], "text_preview": "cortex_block = render_plan_cortex(plan)\n            if cortex_block:\n                parts.append(cortex_block)\n    except Exception:\n        pass\n    # Append plan quality warnings if any\n    if (not advisory) and warns and truthy_env(\"JINX_CHAINED_INCLUD", "line_start": 180, "line_end": 212}, {"sha": "45a1a5db6c0881b0fa148d413b51639fda13c2b72fdc0337f5e8a44547d8f7b9", "index": 7, "path": "49599ce2__jinx__micro__llm__chains.py\\45a1a5db6c0881b0fa148d413b51639fda13c2b72fdc0337f5e8a44547d8f7b9.json", "terms": ["parts", "append", "except", "exception", "try", "final_ctx", "ref_block", "safe_rk", "reflect", "cit", "evidence", "for", "met", "pass", "rkb", "truthy_env", "block", "kernels", "optional", "plan", "build_citation_block", "build_metrics_block", "finalize_context", "jinx_chained_include_citations", "jinx_chained_include_metrics"], "text_preview": "ref_block = render_reflection_block(reflect)\n    if ref_block:\n        parts.append(ref_block)\n    # If reflector provided helper kernels for next steps, include them as well\n    try:\n        rk = str(reflect.get(\"kernels\") or \"\") if reflect else \"\"\n    ex", "line_start": 213, "line_end": 248}], "file_terms": ["plan", "try", "except", "exception", "parts", "from", "import", "str", "await", "last", "append", "micro", "pass", "get", "warns", "jinx", "llm", "brain", "truthy_env", "for", "reflect", "evidence", "not", "cortex_block", "final_ctx"]}