{"file_rel": "jinx\\micro\\memory\\history_compactor.py", "file_sha256": "7cb0df3d949e675dfcdb5010c32c1af54eae094c77a22346cfc5e233bce82a2c", "updated_ts": 1760763312.4851987, "total_chunks": 4, "chunks": [{"sha": "2f7686f5a55adb69cf6e935f56549e0f317639843d0f162665ea55d9498391c0", "index": 0, "path": "6fb56acf__jinx__micro__memory__history_compactor.py\\2f7686f5a55adb69cf6e935f56549e0f317639843d0f162665ea55d9498391c0.json", "terms": ["import", "from", "jinx", "history", "path", "_hist_dir", "_weekly_dir", "def", "int", "join", "memory", "weekly", "_dt", "exist_ok", "max_files", "memory_dir", "ts_ms", "datetime", "except", "exception", "makedirs", "none", "return", "true", "try"], "text_preview": "from __future__ import annotations\n\nimport os\nimport time\nimport datetime as _dt\nfrom collections import Counter\nfrom typing import Dict, List, Tuple\n\nfrom jinx.micro.memory.storage import memory_dir\nfrom jinx.async_utils.fs import read_text_raw, write_tex", "line_start": 1, "line_end": 40}, {"sha": "07d6332b429b1857856ca1b7fedd592d41696bdb94d2e01e5785155b2d318874", "index": 1, "path": "6fb56acf__jinx__micro__memory__history_compactor.py\\07d6332b429b1857856ca1b7fedd592d41696bdb94d2e01e5785155b2d318874.json", "terms": ["names", "try", "min_interval", "except", "exception", "int", "last", "ts_ms", "_hist_dir", "max_files", "ts_str", "path", "time", "and", "for", "now", "prefix", "return", "_ensure_dirs", "_stamp", "_state", "_week_key", "jinx_mem_history_compact_min_interval_ms", "shard_lock", "st_mtime"], "text_preview": "Controlled by env gates in optimizer; function is idempotent and throttled upstream.\n    \"\"\"\n    _ensure_dirs()\n    # Throttle by last-run stamp\n    try:\n        min_interval = int(os.getenv(\"JINX_MEM_HISTORY_COMPACT_MIN_INTERVAL_MS\", \"180000\"))\n    except", "line_start": 41, "line_end": 78}, {"sha": "3f5d943074e16fc57414f7bfe7406ee8a0e9706a568a94a4f18ca568e54da906", "index": 2, "path": "6fb56acf__jinx__micro__memory__history_compactor.py\\3f5d943074e16fc57414f7bfe7406ee8a0e9706a568a94a4f18ca568e54da906.json", "terms": ["body", "startswith", "elif", "for", "items", "not", "path", "agg", "continue", "ctr", "join", "lines", "raw", "_weekly_dir", "most_common", "read_text_raw", "shard_lock", "and", "async", "await", "buckets", "counter", "crude", "decision", "endswith"], "text_preview": "body = await read_text_raw(path)\n            except Exception:\n                body = \"\"\n            if not body:\n                continue\n            c = agg.setdefault(wk, Counter())\n            for raw in (body or \"\").splitlines():\n                ln = ", "line_start": 79, "line_end": 109}, {"sha": "bd9672d8ff455dcea3b05a91e91717db636f62f12affeb59b6a5d532d0af626e", "index": 3, "path": "6fb56acf__jinx__micro__memory__history_compactor.py\\bd9672d8ff455dcea3b05a91e91717db636f62f12affeb59b6a5d532d0af626e.json", "terms": ["time", "except", "exception", "_stamp", "write_text", "await", "body", "continue", "encoding", "int", "open", "outp", "pass", "stamp", "str", "try", "utf", "with", "write"], "text_preview": "await write_text(outp, body)\n            except Exception:\n                continue\n    # stamp\n    try:\n        with open(_STAMP, \"w\", encoding=\"utf-8\") as f:\n            f.write(str(int(time.time() * 1000)))\n    except Exception:\n        pass", "line_start": 110, "line_end": 118}], "file_terms": ["body", "path", "except", "exception", "import", "try", "int", "names", "from", "for", "join", "_hist_dir", "ts_ms", "time", "jinx", "startswith", "min_interval", "_weekly_dir", "max_files", "elif", "history", "last", "not", "return", "weekly"]}