{"file_rel": "jinx\\micro\\runtime\\handlers\\refactor_split.py", "file_sha256": "dba68486670e122011d33e745a9133e2952e6433ede13d4fad210a617ddb3921", "updated_ts": 1760763313.1935792, "total_chunks": 5, "chunks": [{"sha": "25ade8370c090c9fdb98f7080f60b0bf6875f88be5f46870cbcf0e781a5471c8", "index": 0, "path": "ff586993__jinx__micro__runtime__handlers__refactor_split.py\\25ade8370c090c9fdb98f7080f60b0bf6875f88be5f46870cbcf0e781a5471c8.json", "terms": ["str", "import", "none", "from", "optional", "into", "bool", "list", "_abs_path", "_read", "ap_src", "out_dir", "report_progress", "src_path", "await", "awaitable", "callable", "dict", "jinx", "micro", "runtime", "symbols", "tid", "try", "verifycb"], "text_preview": "from __future__ import annotations\n\nimport os\nimport asyncio\nimport ast\nfrom typing import Callable, Awaitable, List, Dict, Tuple, Optional\n\nfrom jinx.micro.runtime.api import report_progress, report_result\nfrom jinx.micro.runtime.handlers.batch_handler im", "line_start": 1, "line_end": 41}, {"sha": "362ece3901cf5625622bd1cbb64f960fd59e166d50b812b3dce6d057b38853f9", "index": 1, "path": "ff586993__jinx__micro__runtime__handlers__refactor_split.py\\362ece3901cf5625622bd1cbb64f960fd59e166d50b812b3dce6d057b38853f9.json", "terms": ["name", "node", "ast", "int", "getattr", "str", "not", "symbols", "await", "list", "create_init", "insert_shim", "_truthy", "ap_out", "end_lineno", "report_result", "else", "error", "false", "for", "lineno", "none", "parse", "return", "tid"], "text_preview": "tree = await asyncio.to_thread(ast.parse, text)\n        except Exception as e:\n            await report_result(tid, False, error=f\"ast parse failed: {e}\")\n            return\n        symbols: List[Tuple[str, int, int, str]] = []  # (name, lineno, end_lineno", "line_start": 42, "line_end": 61}, {"sha": "837ce29071e5ccb6cec33cbd6a591e1b0004ee7df033b1ded302a097302280e9", "index": 2, "path": "ff586993__jinx__micro__runtime__handlers__refactor_split.py\\837ce29071e5ccb6cec33cbd6a591e1b0004ee7df033b1ded302a097302280e9.json", "terms": ["kept", "for", "lines", "pkg_init_text", "join", "idx", "len", "mask", "name", "symbols", "__init__", "ap_out", "dst_file", "dst_module", "pkg_init_path", "shim_imports", "build", "max", "min", "path", "_import_insertion_index", "_module_name_from_path", "_read", "src_new", "after"], "text_preview": "# Build write for src after removing all symbols\n        lines = text.splitlines()\n        mask = [False] * len(lines)\n        for _, s, e, _ in symbols:\n            s1 = max(1, min(s, len(lines)))\n            e1 = max(s1, min(e, len(lines)))\n            f", "line_start": 62, "line_end": 87}, {"sha": "75140c3f551c803288c8aa5411f845494752dc6162c0e5cb287bb3fa6cb4a83f", "index": 3, "path": "ff586993__jinx__micro__runtime__handlers__refactor_split.py\\75140c3f551c803288c8aa5411f845494752dc6162c0e5cb287bb3fa6cb4a83f.json", "terms": ["dst_new", "name", "init_lines", "code", "dst_file", "dst_text", "export_line", "join", "lines", "not", "append", "endswith", "for", "len", "max", "min", "path", "rstrip", "_read", "ap_out", "init_new", "ops_all", "pkg_init_text", "and", "any"], "text_preview": "init_lines = pkg_init_text.splitlines()\n        for name, s, e, _ in symbols:\n            # extract code slice\n            s1 = max(1, min(s, len(lines)))\n            e1 = max(s1, min(e, len(lines)))\n            code = \"\\n\".join(lines[s1 - 1 : e1])\n       ", "line_start": 88, "line_end": 111}, {"sha": "8087caaf05ab62ba658c9858a976fc244354a29b945a24154a1a95da135e1363", "index": 4, "path": "ff586993__jinx__micro__runtime__handlers__refactor_split.py\\8087caaf05ab62ba658c9858a976fc244354a29b945a24154a1a95da135e1363.json", "terms": ["ops_all", "refactor", "split", "verify_cb", "await", "tid", "write", "exports", "force", "append", "code", "meta", "path", "role", "type", "_h_batch", "_truthy", "ap_src", "dst_init", "init_new", "jinx_refactor_force", "pkg_init_path", "report_progress", "report_result", "src_new"], "text_preview": "ops_all.append({\"type\": \"write\", \"path\": pkg_init_path, \"code\": init_new, \"meta\": {\"refactor\": \"split\", \"role\": \"dst_init\"}})\n        # Finally, write source shim\n        ops_all.append({\"type\": \"write\", \"path\": ap_src, \"code\": src_new, \"meta\": {\"refactor\"", "line_start": 112, "line_end": 119}], "file_terms": ["name", "str", "await", "import", "symbols", "none", "for", "not", "dst_new", "lines", "kept", "from", "join", "split", "tid", "ast", "node", "append", "code", "list", "path", "ap_out", "dst_file", "ops_all", "pkg_init_text"]}