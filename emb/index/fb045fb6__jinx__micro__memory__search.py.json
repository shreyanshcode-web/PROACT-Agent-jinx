{"file_rel": "jinx\\micro\\memory\\search.py", "file_sha256": "9a9c7ec2927ece83be05506cf04d424a44e3052c8c4fce76218635a8310d7ccd", "updated_ts": 1760763312.5822694, "total_chunks": 7, "chunks": [{"sha": "1dec215b67c76e414ac93c532835d17981732264d9ef5cd6327a321b76be6037", "index": 0, "path": "fb045fb6__jinx__micro__memory__search.py\\1dec215b67c76e414ac93c532835d17981732264d9ef5cd6327a321b76be6037.json", "terms": ["import", "str", "list", "from", "int", "asyncio", "_rank_conc_limit", "dict", "jinx", "memory", "micro", "_rank_ttl_ms", "semaphore", "and", "except", "exception", "getenv", "try", "tuple", "__future__", "_c_cache", "_c_mtime", "_e_cache", "_e_mtime", "_get_mtimes"], "text_preview": "from __future__ import annotations\n\nimport math\nimport re\nfrom typing import Dict, List, Tuple\nimport time\nimport os\nimport asyncio\n\nfrom jinx.micro.memory.storage import read_compact as _read_compact, read_evergreen as _read_evergreen, get_memory_mtimes a", "line_start": 1, "line_end": 38}, {"sha": "382cf947d66bffabe12dd35fbd48a7810f5113c9c346e6a54ebf97131ea10827", "index": 1, "path": "fb045fb6__jinx__micro__memory__search.py\\382cf947d66bffabe12dd35fbd48a7810f5113c9c346e6a54ebf97131ea10827.json", "terms": ["str", "return", "def", "lines", "low", "for", "idf", "list", "int", "strip", "dict", "query", "seen", "preview_chars", "cache", "set", "bool", "compact", "float", "not", "out", "scope", "txt", "_build_idf", "_is_code_like"], "text_preview": "out.append(t)\n    return out\n\n\ndef _lines_of(txt: str) -> List[str]:\n    return [ln.strip() for ln in (txt or \"\").splitlines() if ln.strip()]\n\n\ndef _build_idf(lines: List[str]) -> Dict[str, float]:\n    df: Dict[str, int] = {}\n    N = max(1, len(lines))\n   ", "line_start": 39, "line_end": 80}, {"sha": "a5cac3c04134348562e72df435cad1ff28ca805e6e55fe2626af059772812298", "index": 2, "path": "fb045fb6__jinx__micro__memory__search.py\\a5cac3c04134348562e72df435cad1ff28ca805e6e55fe2626af059772812298.json", "terms": ["fut", "comp", "cache_key", "m_c", "ent", "ever", "except", "exception", "try", "_c_cache", "_c_mtime", "m_e", "await", "list", "_rank_ttl_ms", "_e_cache", "_e_mtime", "_lines_of", "_rank_inflight", "now_ms", "not", "time", "and", "get", "loop"], "text_preview": "global _C_MTIME, _E_MTIME, _C_CACHE, _E_CACHE\n    # TTL cache / coalescing key\n    cache_key = f\"{scope}|{k}|{preview_chars}|{q}\"\n    now_ms = int(time.time() * 1000)\n    # fast hit\n    ent = _RANK_CACHE.get(cache_key)\n    if ent and (_RANK_TTL_MS <= 0 or ", "line_start": 81, "line_end": 122}, {"sha": "c61551d6a0060396f8e89db7c540e0a4dfbbe14e010abe94e10035866d7a1ce8", "index": 3, "path": "fb045fb6__jinx__micro__memory__search.py\\c61551d6a0060396f8e89db7c540e0a4dfbbe14e010abe94e10035866d7a1ce8.json", "terms": ["pool", "max_lines", "except", "exception", "try", "max_len", "for", "cache_key", "and", "ever", "fut", "pass", "_rank_inflight", "any", "comp", "else", "getenv", "int", "not", "scope", "_e_cache", "_e_mtime", "_rank_cache", "jinx_mem_rank_max_line_chars", "jinx_mem_rank_max_lines"], "text_preview": "_E_MTIME = m_e\n    else:\n        ever = _E_CACHE or []\n\n    if scope == \"evergreen\":\n        pool = ever\n    elif scope == \"any\":\n        pool = ever + comp\n    else:\n        pool = comp\n    if not pool:\n        # resolve coalesced future with empty result", "line_start": 123, "line_end": 164}, {"sha": "014a0e4bdd639e5e8f5afa75aad248c9ac932854eca7a07a392c5ebdcf906d11", "index": 4, "path": "fb045fb6__jinx__micro__memory__search.py\\014a0e4bdd639e5e8f5afa75aad248c9ac932854eca7a07a392c5ebdcf906d11.json", "terms": ["except", "exception", "try", "float", "getenv", "g_hits", "use_g", "for", "pool", "str", "max_ms", "q_toks", "gboost", "idf", "int", "list", "low", "lower", "score", "time", "tuple", "_build_idf", "_graph_activate", "_rank_sem", "_tokens"], "text_preview": "# Concurrency limit for heavy work\n    async with _RANK_SEM:\n        idf = _build_idf(pool)\n    q_toks = _tokens(q)\n\n    scored: List[Tuple[float, int, str]] = []\n    L = len(pool)\n    # time budget\n    try:\n        max_ms = float(os.getenv(\"JINX_MEM_RANK_", "line_start": 165, "line_end": 203}, {"sha": "8eb8973c57ddf7a2c108326cbdf9ffc0ba8f6a81f68d51320627d0391d4b7767", "index": 5, "path": "fb045fb6__jinx__micro__memory__search.py\\8eb8973c57ddf7a2c108326cbdf9ffc0ba8f6a81f68d51320627d0391d4b7767.json", "terms": ["out", "score", "key", "and", "except", "exception", "for", "list", "scored", "try", "max_ms", "g_hits", "append", "boost", "break", "continue", "fut", "gboost", "rec", "_idx", "_is_codey", "_is_error", "_rank_cache", "cache_key", "now_ms"], "text_preview": "# graph boost by matching activated node keys\n        if g_hits and gboost > 0.0:\n            for key, sc in g_hits:\n                try:\n                    if key and key.lower() in low:\n                        score += gboost * float(sc)\n               ", "line_start": 204, "line_end": 241}, {"sha": "aac1ac3d23a56cce1c2a23725be4dbb9b2ce9b1fa2f147d158f9dac58636b5c5", "index": 6, "path": "fb045fb6__jinx__micro__memory__search.py\\aac1ac3d23a56cce1c2a23725be4dbb9b2ce9b1fa2f147d158f9dac58636b5c5.json", "terms": ["_rank_inflight", "cache_key", "pass", "cleanup", "except", "exception", "finally", "fut", "get", "inflight", "none", "out", "pop", "return", "try"], "text_preview": "pass\n    finally:\n        # cleanup inflight\n        try:\n            if _RANK_INFLIGHT.get(cache_key) is fut:\n                _RANK_INFLIGHT.pop(cache_key, None)\n        except Exception:\n            pass\n    return out", "line_start": 242, "line_end": 250}], "file_terms": ["str", "exception", "except", "try", "list", "for", "pool", "int", "fut", "and", "cache_key", "import", "return", "out", "not", "getenv", "_rank_inflight", "low", "comp", "ever", "float", "pass", "score", "time", "def"]}